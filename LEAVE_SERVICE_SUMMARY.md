# โ Leave Service - ููุฎุต ุงูุฅูุฌุงุฒ

## ๐ฆ ูุง ุชู ุชูููุฐู

### 1. ุงูุจููุฉ ุงููุงููุฉ
```
apps/leave/
โโโ prisma/
โ   โโโ schema.prisma (5 ููุฏููุงุช)
โ   โโโ seed.ts (10 ุฃููุงุน ุฅุฌุงุฒุงุช + 18 ุนุทูุฉ)
โโโ src/
โ   โโโ common/ (Guards, Decorators, Filters, etc.)
โ   โโโ leave-requests/ (Module ูุงูู)
โ   โโโ leave-balances/ (Module ูุงูู)
โ   โโโ leave-types/ (Module ูุงูู)
โ   โโโ holidays/ (Module ูุงูู)
โ   โโโ app.module.ts
โ   โโโ main.ts (Port 4003)
โโโ Dockerfile
โโโ package.json
โโโ README.md
```

### 2. Database Models

#### LeaveType (ุฃููุงุน ุงูุฅุฌุงุฒุงุช)
- 10 ุฃููุงุน ุงูุชุฑุงุถูุฉ (ุณูููุฉุ ูุฑุถูุฉุ ุทุงุฑุฆุฉุ ุฃูููุฉุ ุฃุจูุฉุ ุฒูุงุฌุ ููุงุฉุ ุฏุฑุงุณูุฉุ ุจุฏูู ุฑุงุชุจุ ุญุฌ)
- ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต (ุฃูุงู ุงูุชุฑุงุถูุฉุ ูุฏููุนุฉ/ุบูุฑ ูุฏููุนุฉุ ูุชุทูุจ ููุงููุฉุ ูุตู ููู)

#### LeaveBalance (ุฃุฑุตุฏุฉ ุงูุฅุฌุงุฒุงุช)
- ุฑุตูุฏ ููู ููุธู ร ููุน ุฅุฌุงุฒุฉ ร ุณูุฉ
- ุญุณุงุจ ุชููุงุฆู: `remainingDays = totalDays - usedDays - pendingDays + carriedOverDays + adjustmentDays`
- ุชุฑุญูู ุฃุฑุตุฏุฉ ุจูู ุงูุณููุงุช
- ุชุนุฏููุงุช ูุฏููุฉ ูุน ุชุชุจุน ุงูุณุจุจ

#### LeaveRequest (ุทูุจุงุช ุงูุฅุฌุงุฒุฉ)
- ุญุงูุงุช: DRAFT โ PENDING_MANAGER โ PENDING_HR โ APPROVED/REJECTED
- ุฏุนู ูุตู ููู (ุตุจุงุญู/ูุณุงุฆู)
- ุจุฏููุ ุชูุงุตูุ ุณุจุจ ุงูุฅูุบุงุก
- ุญุณุงุจ ุชููุงุฆู ูุนุฏุฏ ุงูุฃูุงู (ุงุณุชุซูุงุก ุงูุนุทู ูุงูููููุฏ)

#### LeaveRequestHistory
- ุชุชุจุน ูุงูู ูุฌููุน ุงูุนูููุงุช (ุฅูุดุงุกุ ุชุนุฏููุ ุชูุฏููุ ููุงููุฉุ ุฑูุถุ ุฅูุบุงุก)
- ูู ูุนููุง ููุชู ูููุงุฐุง

#### Holiday (ุงูุนุทู ุงูุฑุณููุฉ)
- 18 ุนุทูุฉ (2024-2026)
- ุนุทู ูุชูุฑุฑุฉ ุณูููุงู
- ูุทุงู ุฒููู (ูู - ุฅูู)

### 3. API Endpoints (40+ endpoint)

#### Leave Requests (15 endpoints)
- โ ุฅูุดุงุก ุทูุจ (DRAFT)
- โ ุชุญุฏูุซ ุทูุจ
- โ ุชูุฏูู ุทูุจ (SUBMIT)
- โ ููุงููุฉ/ุฑูุถ ุงููุฏูุฑ
- โ ููุงููุฉ/ุฑูุถ HR
- โ ุฅูุบุงุก ุทูุจ (ูุน ุฅุฑุฌุงุน ุงูุฑุตูุฏ)
- โ ุญุฐู ุทูุจ (DRAFT ููุท)
- โ ุนุฑุถ ุทูุจุงุชู
- โ ุนุฑุถ ุฌููุน ุงูุทูุจุงุช (HR)
- โ ุนุฑุถ ุทูุจ ูุญุฏุฏ (ูุน ุงูุชุงุฑูุฎ)

#### Leave Balances (8 endpoints)
- โ ุนุฑุถ ุฑุตูุฏู
- โ ุนุฑุถ ุฑุตูุฏ ููุธู
- โ ุฅูุดุงุก ุฑุตูุฏ
- โ ุชุนุฏูู ุฑุตูุฏ (Adjustment)
- โ ุชุฑุญูู ุฑุตูุฏ (Carry Over)
- โ ุชููุฆุฉ ุฃุฑุตุฏุฉ ููุธู ุฌุฏูุฏ
- โ ุญุฐู ุฑุตูุฏ

#### Leave Types (7 endpoints)
- โ ุนุฑุถ ุฌููุน ุงูุฃููุงุน (ูุดุทุฉ/ุงููู)
- โ ุนุฑุถ ููุน ูุญุฏุฏ (ID ุฃู Code)
- โ ุฅูุดุงุก ููุน ุฌุฏูุฏ
- โ ุชุญุฏูุซ ููุน
- โ ุชูุนูู/ุชุนุทูู ููุน
- โ ุญุฐู ููุน (ูุน ูุญุต ุงูุงุฑุชุจุงุทุงุช)

#### Holidays (8 endpoints)
- โ ุนุฑุถ ุฌููุน ุงูุนุทู (ุญุณุจ ุงูุณูุฉ/ุงูููุน)
- โ ุนุฑุถ ุนุทูุฉ ูุญุฏุฏุฉ
- โ ุนุฑุถ ุนุทู ูู ูุทุงู ุฒููู
- โ ุนุฑุถ ุงูุนุทู ุงููุงุฏูุฉ
- โ ุฅูุดุงุก ุนุทูุฉ
- โ ุชุญุฏูุซ ุนุทูุฉ
- โ ุงุณุชูุณุงุฎ ุนุทู ูู ุณูุฉ ุฅูู ุฃุฎุฑู
- โ ุญุฐู ุนุทูุฉ

### 4. Business Logic

#### ุญุณุงุจ ุงูุฃูุงู ุงูุชููุงุฆู
- ูุณุชุซูู ุงูุนุทู ุงูุฑุณููุฉ
- ูุณุชุซูู ุนุทูุฉ ุงูุฃุณุจูุน (ุงูุฌูุนุฉ/ุงูุณุจุช)
- ูุฏุนู ูุตู ููู
- ูุญุณุจ ุงูุฃูุงู ุงูุนูููุฉ ููุท

#### ุณูุฑ ุนูู ุงูููุงููุงุช
```
DRAFT
  โ submit()
PENDING_MANAGER
  โ approveManager()
PENDING_HR
  โ approveHR()
APPROVED
```

#### ุฅุฏุงุฑุฉ ุงูุฃุฑุตุฏุฉ ุงูุชููุงุฆูุฉ
- ุนูุฏ ุงูููุงููุฉ: `usedDays += totalDays`, `pendingDays -= totalDays`
- ุนูุฏ ุงูุฑูุถ: `pendingDays -= totalDays`
- ุนูุฏ ุงูุฅูุบุงุก: ูุฑุฌุน ุงูุฃูุงู ุญุณุจ ุงูุญุงูุฉ

#### ุงูุตูุงุญูุงุช (Permissions)
- ููุธู ุนุงุฏู: ูุฑู ุทูุจุงุชู ููุท
- ูุฏูุฑ: ููุงูู ุนูู ุทูุจุงุช ูุฑููู
- HR: ููุงูู ุนูู ุฌููุน ุงูุทูุจุงุช + ุฅุฏุงุฑุฉ ุงูุฃุฑุตุฏุฉ
- Admin: ูู ุดูุก

### 5. ุงูุชูุงูู ูุน ุงููุดุฑูุน

#### Gateway
- โ ุฅุถุงูุฉ 4 Controllers ุฌุฏูุฏุฉ:
  - `LeaveRequestsProxyController`
  - `LeaveBalancesProxyController`
  - `LeaveTypesProxyController`
  - `HolidaysProxyController`
- โ ุฅุถุงูุฉ `LEAVE_SERVICE_URL` ูู ProxyService

#### Docker Compose
- โ ุฅุถุงูุฉ `leave` service ูู docker-compose.yml
- โ ุฅุถุงูุฉ `leave` service ูู docker-compose.prod.yml
- โ Port mapping: 4003:4003
- โ Database schema: `leaves`

### 6. Authentication & Authorization
- โ JWT Strategy (Passport)
- โ JwtAuthGuard ุนูู ุฌููุน endpoints
- โ PermissionsGuard ููุญุต ุงูุตูุงุญูุงุช
- โ @Permission decorator
- โ User context ูู token

### 7. Error Handling
- โ GlobalExceptionFilter
- โ ุงุณุชุฌุงุจุฉ ููุญุฏุฉ ููุฃุฎุทุงุก
- โ Validation pipes
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ

### 8. ุงูุจูุงูุงุช ุงูุฃูููุฉ (Seed)

#### ุฃููุงุน ุงูุฅุฌุงุฒุงุช:
1. **ANNUAL** - ุฅุฌุงุฒุฉ ุณูููุฉ (21 ูููุ ูุฏููุนุฉ)
2. **SICK** - ุฅุฌุงุฒุฉ ูุฑุถูุฉ (15 ูููุ ูุฏููุนุฉ)
3. **EMERGENCY** - ุฅุฌุงุฒุฉ ุทุงุฑุฆุฉ (5 ุฃูุงูุ ูุฏููุนุฉ)
4. **MATERNITY** - ุฅุฌุงุฒุฉ ุฃูููุฉ (70 ูููุ ูุฏููุนุฉ)
5. **PATERNITY** - ุฅุฌุงุฒุฉ ุฃุจูุฉ (3 ุฃูุงูุ ูุฏููุนุฉ)
6. **MARRIAGE** - ุฅุฌุงุฒุฉ ุฒูุงุฌ (5 ุฃูุงูุ ูุฏููุนุฉ)
7. **BEREAVEMENT** - ุฅุฌุงุฒุฉ ููุงุฉ (3 ุฃูุงูุ ูุฏููุนุฉ)
8. **STUDY** - ุฅุฌุงุฒุฉ ุฏุฑุงุณูุฉ (10 ุฃูุงูุ ุบูุฑ ูุฏููุนุฉ)
9. **UNPAID** - ุฅุฌุงุฒุฉ ุจุฏูู ุฑุงุชุจ (0 ุฃูุงูุ ุบูุฑ ูุฏููุนุฉ)
10. **HAJJ** - ุฅุฌุงุฒุฉ ุญุฌ (10 ุฃูุงูุ ูุฏููุนุฉ)

#### ุงูุนุทู ุงูุฑุณููุฉ (2024-2026):
1. ุฑุฃุณ ุงูุณูุฉ ุงููููุงุฏูุฉ (1 ููุงูุฑ)
2. ุนูุฏ ุงููุทุฑ (3 ุฃูุงู)
3. ุนูุฏ ุงูุฃุถุญู (4 ุฃูุงู)
4. ุฑุฃุณ ุงูุณูุฉ ุงููุฌุฑูุฉ (1 ููู)
5. ุงููููุฏ ุงููุจูู (1 ููู)
6. ุงูููู ุงููุทูู (1 ููู)

**ุงููุฌููุน**: 18 ุนุทูุฉ (6 ููู ุณูุฉ)

---

## ๐ ููููุฉ ุงูุชุดุบูู

### Local Development
```bash
# ูู terminal ูููุตู
cd apps/leave
npm install
npx prisma migrate dev
npm run prisma:seed
npm run start:dev
```

### Docker Compose
```bash
# ุณูุดุบู Leave Service ุชููุงุฆูุงู
docker-compose up -d --build
```

### ุงุฎุชุจุงุฑ Endpoints
```bash
# Login ุฃููุงู
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123"}'

# ุนุฑุถ ุฃููุงุน ุงูุฅุฌุงุฒุงุช
curl http://localhost:8000/api/v1/leave-types \
  -H "Authorization: Bearer YOUR_TOKEN"

# ุนุฑุถ ุงูุนุทู 2024
curl http://localhost:8000/api/v1/holidays?year=2024 \
  -H "Authorization: Bearer YOUR_TOKEN"

# ุฅูุดุงุก ุทูุจ ุฅุฌุงุฒุฉ
curl -X POST http://localhost:8000/api/v1/leave-requests \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "leaveTypeId": "uuid-from-leave-types",
    "startDate": "2024-02-01",
    "endDate": "2024-02-05",
    "reason": "ุฅุฌุงุฒุฉ ุณูููุฉ"
  }'
```

---

## โจ ุงูููุฒุงุช ุงููุชูุฏูุฉ

1. **History Tracking** - ุชุชุจุน ูุงูู ูุฌููุน ุงูุนูููุงุช
2. **Automatic Balance Management** - ุฅุฏุงุฑุฉ ุชููุงุฆูุฉ ููุฃุฑุตุฏุฉ
3. **Holiday Calculation** - ุญุณุงุจ ุชููุงุฆู ูุณุชุซูู ุงูุนุทู
4. **Half-Day Support** - ุฏุนู ูุตู ููู (ุตุจุงุญู/ูุณุงุฆู)
5. **Carry Over** - ุชุฑุญูู ุงูุฃุฑุตุฏุฉ ุจูู ุงูุณููุงุช
6. **Balance Adjustment** - ุชุนุฏููุงุช ูุฏููุฉ ูุน ุชุชุจุน ุงูุณุจุจ
7. **Approval Workflow** - ุณูุฑ ุนูู ููุงููุงุช (Manager โ HR)
8. **Cancellation** - ุฅูุบุงุก ูุน ุฅุฑุฌุงุน ุงูุฑุตูุฏ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **5 Models** ูู Prisma Schema
- **40+ Endpoints** ูุงููุฉ ูููุซูุฉ
- **4 Modules** (Requests, Balances, Types, Holidays)
- **10 ุฃููุงุน ุฅุฌุงุฒุงุช** ุงูุชุฑุงุถูุฉ
- **18 ุนุทูุฉ** ุฑุณููุฉ (3 ุณููุงุช)
- **100% Coverage** ูุฌููุน ูุชุทูุจุงุช API Guide

---

## โ Checklist

- [x] Prisma Schema ูุงูู
- [x] Leave Requests Module (15 endpoints)
- [x] Leave Balances Module (8 endpoints)
- [x] Leave Types Module (7 endpoints)
- [x] Holidays Module (8 endpoints)
- [x] JWT Authentication
- [x] Permission Guards
- [x] Error Handling
- [x] Response Interceptor
- [x] Seed Data
- [x] Dockerfile
- [x] Gateway Integration
- [x] Docker Compose
- [x] README Documentation

---

**๐ Leave Service ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู 100%!**
